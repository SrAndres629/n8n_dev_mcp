services:
  n8n-mcp:
    build: .
    container_name: n8n-architect-mcp
    restart: unless-stopped
    ports:
      # Maps Host Port : Container Port
      # You can change the first number if 8000 is occupied on your host
      - "${API_PORT:-8001}:${API_PORT:-8001}"
    env_file:
      - .env
    environment:
      # Ensure inner app knows its port
      - API_PORT=${API_PORT:-8001}
      - API_HOST=0.0.0.0
      # Allow connection to host services (like local n8n)
      - N8N_BASE_URL=${N8N_BASE_URL:-http://host.docker.internal:5678/api/v1}
      - ENABLE_DOCKER_TOOLS=${ENABLE_DOCKER_TOOLS:-true}
      - ENABLE_N8N_TOOLS=${ENABLE_N8N_TOOLS:-true}
    volumes:
      # Docker Socket Access (Vital for the "Architect" skills)
      - /var/run/docker.sock:/var/run/docker.sock
    extra_hosts:
      - "host.docker.internal:host-gateway"

    # Healthcheck to ensure it's actually responding
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:${API_PORT:-8001}/health"]
      interval: 30s
      timeout: 10s
      retries: 3

